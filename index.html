<script>
    document.addEventListener('DOMContentLoaded', function() {
        var currentURL = window.location.href;
        var keywordIndex = currentURL.indexOf('?');

        if (keywordIndex !== -1) {
            var keyword = currentURL.substring(keywordIndex + 1);

            // Kiểm tra nếu keyword là 6 ký tự số
            var isSixDigitNumber = /^\d{6}$/.test(keyword);

            if (isSixDigitNumber) {
                // Lấy URL của trang web trước
                var previousURL = document.referrer;
                // Phân tích URL để trích xuất keyword
                var previousKeyword = "";
                var prevKeywordIndex = previousURL.indexOf('?');
                if (prevKeywordIndex !== -1) {
                    previousKeyword = previousURL.substring(prevKeywordIndex + 1);
                }

                // Tạo URL mới với ref là previousKeyword
                var newURL = 'https://apks2life.github.io/?ref=' + previousKeyword;
                
                // Chuyển hướng đến URL mới với ref
                window.location.href = newURL;
            } else if (currentURL.includes('?ref=')) {
                // Lấy URL của trang web trước
                var previousURL = document.referrer;
                // Phân tích URL để trích xuất keyword
                var previousKeyword = "";
                var prevKeywordIndex = previousURL.indexOf('?');
                if (prevKeywordIndex !== -1) {
                    previousKeyword = previousURL.substring(prevKeywordIndex + 1);
                }
                
                // Sử dụng previousKeyword để gọi hàm fetchOriginalLink
                fetchOriginalLink(previousKeyword);
            } else {
                fetchOriginalLink(keyword);
            }
        }

        function fetchOriginalLink(keyword) {
            fetch('https://script.google.com/macros/s/AKfycbwJgR1iLkDU-Hly1MHRR4kfUFpkmm27kE9bxwxEMFg0_UpV_moIIhSjR1sWLcNXcIR9bg/exec?keyword=' + keyword)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.originalLink) {
                        // Chuyển hướng trực tiếp đến link gốc
                        window.location.href = data.originalLink;
                    } else {
                        console.error('Không tìm thấy link gốc.');
                    }
                })
                .catch(error => console.error('Error:', error));
        }
    });
</script>
