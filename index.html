<script>
document.addEventListener('DOMContentLoaded', function() {
    // Lấy keyword hoặc refid từ URL
    var keyword = new URLSearchParams(window.location.search).get('keyword') || new URLSearchParams(window.location.search).get('refid');

    if (keyword) {
        fetchOriginalLink(keyword);
    } else {
        alert('Không có từ khóa hoặc refid trong URL.');
    }
});

function fetchOriginalLink(keyword) {
    // Dùng toString để đảm bảo keyword được xử lý dưới dạng chuỗi
    var url = `https://script.google.com/macros/s/AKfycbwJgR1iLkDU-Hly1MHRR4kfUFpkmm27kE9bxwxEMFg0_UpV_moIIhSjR1sWLcNXcIR9bg/exec?keyword=${keyword.toString()}`;

    fetch(url, {
        method: 'GET',
        cache: 'no-cache'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.originalLink) {
            var refid = new URLSearchParams(window.location.search).get('refid');
            var finalLink = data.originalLink;

            // Thêm refid vào link gốc nếu có refid
            if (refid) {
                finalLink += `?refid=${refid}`;
            }

            // Chuyển hướng đến link gốc đã thêm refid
            window.location.href = finalLink;
        } else {
            alert('Không tìm thấy liên kết gốc cho từ khóa hoặc refid.');
        }
    })
    .catch(error => {
        alert('Đã xảy ra lỗi khi lấy liên kết gốc.');
    });
}
</script>
